å½“ä½¿ç”¨ `vx.y.z` æ ¼å¼çš„ tag è§¦å‘ workflow æ—¶ï¼Œè¾“å‡ºäº§ç‰©ä¼šæœ‰ä¸€äº›å˜åŒ–ã€‚è®©æˆ‘ä»¬åˆ†æï¼š

## Tag è§¦å‘çš„è¡Œä¸ºå˜åŒ–

### å…³é”®é€»è¾‘ï¼š
åœ¨ `setup-platforms` ä½œä¸šä¸­çš„ç‰ˆæœ¬è·å–ï¼š

```yaml
- name: Get version from tag
  id: get-version
  run: |
    if [[ "${{ github.ref }}" == refs/tags/v* ]]; then
      VERSION="${GITHUB_REF#refs/tags/v}"  # å»æ‰ "v" å‰ç¼€
      echo "version=$VERSION" >> $GITHUB_OUTPUT
    elif [[ "${{ github.ref }}" == refs/tags/* ]]; then
      VERSION="${GITHUB_REF#refs/tags/}"  # å»æ‰ "refs/tags/"
      echo "version=$VERSION" >> $GITHUB_OUTPUT
    else
      VERSION="latest"
      echo "version=$VERSION" >> $GITHUB_OUTPUT
    fi
```

## å„åœºæ™¯çš„ tag ç‰ˆæœ¬è¾“å‡º

### ç¤ºä¾‹ï¼š`git tag v1.2.3; git push origin v1.2.3;`

#### åœºæ™¯1ï¼šçº¯ Docker å‘å¸ƒ
```bash
gh workflow run next-release.yml -f release=true -f platforms="none" -f build_docker=true;
```

**è¾“å‡ºäº§ç‰©**ï¼š
```
ğŸ“¦ Dockeré•œåƒï¼š
  âœ… ghcr.io/ymc-github/i_edit_toml:1.2.3 (ä¸»è¦ç‰ˆæœ¬)
  âœ… ghcr.io/ymc-github/i_edit_toml:latest (å¦‚æœæ˜¯ main åˆ†æ”¯)

ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ï¼šæ— 
  
ğŸš€ GitHub Releaseï¼šâŒ æ— 

ğŸ”§ æ³¨æ„ï¼šç‰ˆæœ¬æ˜¯ "1.2.3" è€Œä¸æ˜¯ "latest"
```

#### åœºæ™¯2ï¼šçº¯ Windows å‘å¸ƒ
```bash
gh workflow run next-release.yml -f release=true -f platforms="windows" -f build_docker=false;
```

**è¾“å‡ºäº§ç‰©**ï¼š
```
ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ï¼š
  âœ… i_edit_toml-windows-amd64.exe
  
ğŸ“¦ Dockeré•œåƒï¼šæ— 
  
ğŸš€ GitHub Releaseï¼šâœ… åˆ›å»º (v1.2.3)
  ğŸ“„ åŒ…å«ï¼š
    - i_edit_toml-windows-amd64.exe (v1.2.3 ç‰ˆæœ¬)
    - æ ¡éªŒå’Œæ–‡ä»¶
  ğŸ·ï¸ ç‰ˆæœ¬ï¼šv1.2.3 (è€Œä¸æ˜¯ latest)
```

#### åœºæ™¯5ï¼šLinux + Docker å‘å¸ƒ
```bash
gh workflow run next-release.yml -f release=true -f platforms="linux" -f build_docker=true;
```

**è¾“å‡ºäº§ç‰©**ï¼š
```
ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ï¼š
  âœ… i_edit_toml-linux-amd64 (v1.2.3 ç‰ˆæœ¬)
  
ğŸ“¦ Dockeré•œåƒï¼š
  âœ… ghcr.io/ymc-github/i_edit_toml:1.2.3 (ä¸»è¦ç‰ˆæœ¬)
  âœ… ghcr.io/ymc-github/i_edit_toml:latest (å¦‚æœæ˜¯ main åˆ†æ”¯)
  
ğŸš€ GitHub Releaseï¼šâœ… åˆ›å»º (v1.2.3)
  ğŸ“„ åŒ…å«ï¼š
    - i_edit_toml-linux-amd64
    - æ ¡éªŒå’Œæ–‡ä»¶
  ğŸ·ï¸ ç‰ˆæœ¬ï¼šv1.2.3
```

#### åœºæ™¯6ï¼šå®Œæ•´å‘å¸ƒ
```bash
gh workflow run next-release.yml -f release=true -f platforms="linux,windows,macos" -f build_docker=true;
```

**è¾“å‡ºäº§ç‰©**ï¼š
```
ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ (v1.2.3)ï¼š
  âœ… i_edit_toml-linux-amd64
  âœ… i_edit_toml-windows-amd64.exe
  âœ… i_edit_toml-macos-amd64
  âœ… i_edit_toml-macos-arm64
  
ğŸ“¦ Dockeré•œåƒï¼š
  âœ… ghcr.io/ymc-github/i_edit_toml:1.2.3 (ä¸»è¦ç‰ˆæœ¬)
  âœ… ghcr.io/ymc-github/i_edit_toml:latest (å¦‚æœæ˜¯ main åˆ†æ”¯)
  
ğŸš€ GitHub Releaseï¼šâœ… åˆ›å»º (v1.2.3)
  ğŸ“„ åŒ…å«ï¼šæ‰€æœ‰5ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ + æ ¡éªŒå’Œ
  ğŸ·ï¸ ç‰ˆæœ¬ï¼šv1.2.3
  ğŸ“ è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒè¯´æ˜
```

## Tag ç‰ˆæœ¬çš„ç‰¹æ®Šè§„åˆ™

### 1. **ç‰ˆæœ¬å·å¤„ç†**ï¼š
- `v1.2.3` â†’ `1.2.3` (å»æ‰ "v" å‰ç¼€)
- `beta-1.0` â†’ `beta-1.0` (ä¿æŒåŸæ ·)
- é tag è§¦å‘ â†’ `latest`

### 2. **Docker æ ‡ç­¾ç­–ç•¥**ï¼š
åœ¨ `prepare-tags` æ­¥éª¤ä¸­ï¼š
```yaml
if [ "${{ github.ref }}" = "refs/heads/main" ] && [ "${{ needs.setup-platforms.outputs.version }}" = "latest" ]; then
  TAGS="$TAGS,ghcr.io/${{ needs.setup-platforms.outputs.repository_lower }}:latest"
fi
```

è¿™æ„å‘³ç€ï¼š
- **Tag è§¦å‘æ—¶**ï¼šä¸ä¼šæ·»åŠ  `:latest` æ ‡ç­¾
- **main åˆ†æ”¯ + latest ç‰ˆæœ¬æ—¶**ï¼šä¼šæ·»åŠ  `:latest` æ ‡ç­¾

### 3. **GitHub Release çš„ prerelease æ ‡è®°**ï¼š
```yaml
prerelease: ${{ contains(needs.setup-platforms.outputs.version, '-alpha') || 
                 contains(needs.setup-platforms.outputs.version, '-beta') || 
                 contains(needs.setup-platforms.outputs.version, '-rc') }}
```

ç¤ºä¾‹ï¼š
- `v1.2.3-alpha.1` â†’ prerelease: true
- `v1.2.3-beta.2` â†’ prerelease: true  
- `v1.2.3-rc.1` â†’ prerelease: true
- `v1.2.3` â†’ prerelease: false

## å®é™…çš„ tag ç¤ºä¾‹

### æ­£å¼ç‰ˆæœ¬ tagï¼š
```bash
git tag v2.0.0
git push origin v2.0.0
```

**äº§ç‰©ç‰¹ç‚¹**ï¼š
- æ‰€æœ‰äº§ç‰©ç‰ˆæœ¬å·ï¼š2.0.0
- GitHub Releaseï¼šv2.0.0 (éé¢„å‘å¸ƒ)
- Docker æ ‡ç­¾ï¼š`:2.0.0` (æ²¡æœ‰ `:latest`)

### é¢„å‘å¸ƒç‰ˆæœ¬ tagï¼š
```bash
git tag v2.0.0-rc.1
git push origin v2.0.0-rc.1
```

**äº§ç‰©ç‰¹ç‚¹**ï¼š
- æ‰€æœ‰äº§ç‰©ç‰ˆæœ¬å·ï¼š2.0.0-rc.1
- GitHub Releaseï¼šv2.0.0-rc.1 (æ ‡è®°ä¸ºé¢„å‘å¸ƒ)
- Docker æ ‡ç­¾ï¼š`:2.0.0-rc.1`

### æ—  "v" å‰ç¼€çš„ tagï¼š
```bash
git tag 1.2.3
git push origin 1.2.3
```

**äº§ç‰©ç‰¹ç‚¹**ï¼š
- æ‰€æœ‰äº§ç‰©ç‰ˆæœ¬å·ï¼š1.2.3
- GitHub Releaseï¼š1.2.3 (æ²¡æœ‰ "v" å‰ç¼€)
- Docker æ ‡ç­¾ï¼š`:1.2.3`

## ç‰ˆæœ¬å·ä½¿ç”¨çš„å®Œæ•´æµç¨‹

1. **è§¦å‘**ï¼šæ¨é€ tag `v1.2.3`
2. **è§£æ**ï¼š`setup-platforms` æå–å‡º `1.2.3`
3. **æ„å»º**ï¼šæ‰€æœ‰äº§ç‰©ä½¿ç”¨ `1.2.3` ä½œä¸ºç‰ˆæœ¬æ ‡è¯†
4. **æ ‡ç­¾**ï¼š
   - Dockerï¼š`:1.2.3`
   - GitHub Releaseï¼š`v1.2.3` (GitHub ä¼šè‡ªåŠ¨æ·»åŠ  "v")
5. **äº§ç‰©å‘½å**ï¼š
   - äºŒè¿›åˆ¶ï¼š`i_edit_toml-linux-amd64` (æ–‡ä»¶åä¸åŒ…å«ç‰ˆæœ¬å·)
   - Release æ ‡é¢˜ï¼š`v1.2.3` (åŒ…å«ç‰ˆæœ¬å·)

## ä¸æ‰‹åŠ¨è§¦å‘çš„åŒºåˆ«

| æ–¹é¢ | æ‰‹åŠ¨è§¦å‘ (æ— tag) | Tag è§¦å‘ (v1.2.3) |
|------|------------------|-------------------|
| ç‰ˆæœ¬å· | `latest` | `1.2.3` |
| Dockeræ ‡ç­¾ | `:latest` (mainåˆ†æ”¯) | `:1.2.3` |
| GitHub Release | æ ‡é¢˜: è‡ªåŠ¨ç”Ÿæˆ | æ ‡é¢˜: v1.2.3 |
| Releaseæ ‡è®° | éé¢„å‘å¸ƒ | æ ¹æ®åç¼€æ ‡è®°é¢„å‘å¸ƒ |
| é•¿æœŸè¯†åˆ« | éš¾ä»¥è¿½æº¯ | æ˜ç¡®ç‰ˆæœ¬ |

## æœ€ä½³å®è·µå»ºè®®

1. **æ­£å¼å‘å¸ƒ**ï¼š
   ```bash
   git tag v1.2.3
   git push origin v1.2.3
   gh workflow run next-release.yml -f release=true -f platforms="linux,windows,macos" -f build_docker=true
   ```

2. **é¢„å‘å¸ƒæµ‹è¯•**ï¼š
   ```bash
   git tag v1.2.3-rc.1
   git push origin v1.2.3-rc.1
   gh workflow run next-release.yml -f release=true -f platforms="linux" -f build_docker=true
   ```

3. **ç´§æ€¥ä¿®å¤**ï¼š
   ```bash
   # ä¸åˆ›å»ºæ–°tagï¼Œä½¿ç”¨ç°æœ‰tagçš„workflow
   gh workflow run next-release.yml -f release=true -f platforms="windows" -f build_docker=false
   ```

è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†ï¼š
- ç‰ˆæœ¬æ§åˆ¶æ¸…æ™°
- å‘å¸ƒæµç¨‹å¯è¿½æº¯
- æ”¯æŒé¢„å‘å¸ƒæµç¨‹
- çµæ´»çš„å‘å¸ƒç­–ç•¥